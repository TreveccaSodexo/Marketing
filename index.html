<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Resident Dining Marketing & Experience Checklist</title>
  <meta name="theme-color" content="#5B2D8B" />
  <style>
    :root{
      /* Trevecca Purple */
      --purple:#5B2D8B;
      --purple2:#7A3EB7;
      --purpleSoft:#EFE7F7;

      /* Light theme */
      --bg:#ffffff;
      --card:#ffffff;
      --card2:#ffffff;
      --text:#000000;
      --muted:#444444;
      --line:rgba(0,0,0,.14);
      --chip:rgba(91,45,139,.06);

      --shadow: 0 10px 24px rgba(0,0,0,.10);
      --radius:18px;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background: var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    header{
      position: sticky;
      top:0;
      z-index: 10;
      background: rgba(255,255,255,.92);
      border-bottom:1px solid var(--line);
      backdrop-filter: blur(10px);
    }

    .wrap{max-width:860px;margin:0 auto;padding:14px 14px 28px;}

    .topbar{
      display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;
    }

    .title{
      display:flex;flex-direction:column;gap:2px;min-width:240px;
    }

    .title h1{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
      font-weight:900;
      color:#000;
    }
    .title p{
      margin:0;
      color:var(--muted);
      font-size:12px;
      font-weight:800;
    }

    .actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap}

    button, .btn{
      border:1px solid rgba(91,45,139,.35);
      background: #ffffff;
      color:#000;
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      font-size:13px;
      transition: transform .06s ease, background .2s ease, border-color .2s ease;
      touch-action: manipulation;
    }
    button:active{transform: translateY(1px)}
    button:hover{background: rgba(91,45,139,.06)}

    .btn.primary{
      background: linear-gradient(135deg, rgba(91,45,139,.95), rgba(122,62,183,.85));
      border-color: rgba(91,45,139,.65);
      color:#fff;
    }
    .btn.primary:hover{
      background: linear-gradient(135deg, rgba(91,45,139,1), rgba(122,62,183,.92));
    }

    .pill{
      display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;
    }

    .chip{
      background: var(--chip);
      border:1px solid rgba(0,0,0,.12);
      padding:8px 10px;
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
      display:flex;gap:8px;align-items:center;
      font-weight:800;
    }
    .chip b{color:#000;font-weight:900}

    main{padding-top:10px}

    .card{
      background: var(--card);
      border:1px solid rgba(0,0,0,.14);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin: 12px 0;
      overflow:hidden;
    }

    .card-h{
      padding:14px 14px 10px;
      display:flex;align-items:flex-start;justify-content:space-between;gap:10px;
      border-bottom:1px solid rgba(0,0,0,.12);
      background: rgba(91,45,139,.03);
    }
    .card-h h2{
      margin:0;
      font-size:15px;
      font-weight:900;
      color:#000;
    }
    .card-h .meta{
      color:var(--muted);
      font-size:12px;
      line-height:1.2;
      text-align:right;
      font-weight:800;
    }

    .card-b{padding:12px 14px 14px}

    .item{
      display:flex;align-items:flex-start;justify-content:space-between;gap:12px;
      padding:12px 0;
      border-bottom:1px dashed rgba(0,0,0,.16);
    }
    .item:last-child{border-bottom:none}

    .item .text{min-width:0}

    .item .text .label{
      font-size:14px;
      font-weight:900;
      margin:0 0 3px;
      color:#000;
    }
    .item .text .hint{
      margin:0;
      color:var(--muted);
      font-size:12px;
      line-height:1.35;
      font-weight:800;
    }

    /* Bubble toggle (Trevecca purple) */
    .toggle{
      flex:0 0 auto;
      width:56px;height:34px;border-radius:999px;
      background: #fff;
      border:2px solid rgba(91,45,139,.55);
      position:relative;
      cursor:pointer;
      transition: background .2s ease, border-color .2s ease;
      outline: none;
    }
    .toggle input{opacity:0;position:absolute;inset:0;margin:0}

    .knob{
      width:28px;height:28px;border-radius:999px;
      background: rgba(0,0,0,.18);
      position:absolute;top:2px;left:2px;
      transition: transform .18s ease, background .2s ease;
      box-shadow: 0 8px 18px rgba(0,0,0,.20);
    }

    .toggle.on{
      background: var(--purpleSoft);
      border-color: rgba(91,45,139,.85);
    }
    .toggle.on .knob{
      transform: translateX(22px);
      background: var(--purple);
    }

    .subgrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:12px;
    }

    .field{
      background: #ffffff;
      border:1px solid rgba(0,0,0,.14);
      border-radius: 16px;
      padding:10px;
    }
    .field label{
      display:block;
      font-size:12px;
      color:#000;
      margin-bottom:6px;
      font-weight:900;
    }

    textarea, input[type="text"], input[type="date"], input[type="time"]{
      width:100%;
      border:1px solid rgba(0,0,0,.18);
      background: #ffffff;
      color: #000;
      border-radius: 12px;
      padding:10px 10px;
      font-size:14px;
      font-weight:800;
      outline:none;
    }
    textarea{min-height:86px;resize:vertical}

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width:520px){
      .row{grid-template-columns:1fr}
      .card-h .meta{text-align:left}
      .topbar{gap:12px}
      .actions{width:100%}
      .actions button{flex:1}
    }

    .photos{
      display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;
    }
    .thumb{
      width:92px;height:92px;border-radius:14px;
      border:1px solid rgba(0,0,0,.16);
      background: #fff;
      overflow:hidden;
      position:relative;
    }
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .thumb .x{
      position:absolute;top:6px;right:6px;
      width:26px;height:26px;border-radius:999px;
      border:1px solid rgba(0,0,0,.20);
      background: rgba(0,0,0,.75);
      color:#fff;
      font-size:14px;
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;
    }

    .footer-card{
      padding:14px;
      display:grid;
      gap:10px;
    }

    .small{
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
      font-weight:800;
    }

    .progress{
      height:10px;border-radius:999px;border:1px solid rgba(0,0,0,.18);
      background: rgba(0,0,0,.06);
      overflow:hidden;
    }
    .progress > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, rgba(91,45,139,1), rgba(122,62,183,.85));
      transition: width .25s ease;
    }
  </style>
</head>

<body>
<header>
  <div class="wrap">
    <div class="topbar">
      <div class="title">
        <h1>Resident Dining – Marketing & Experience Checklist</h1>
        <p>Sodexo One & All • Mobile daily ops format</p>
      </div>

      <div class="actions">
        <button class="btn" id="btnReset" type="button">Reset</button>
        <button class="btn" id="btnSave" type="button">Save</button>
        <button class="btn" id="btnExport" type="button">Export JSON</button>
        <button class="btn primary" id="btnSummary" type="button">Summary</button>
      </div>
    </div>

    <div class="pill">
      <div class="chip"><span>Site:</span> <b id="siteName">—</b></div>
      <div class="chip"><span>Date:</span> <b id="runDate">—</b></div>
      <div class="chip"><span>Completion:</span> <b id="pct">0%</b></div>
    </div>

    <div class="progress" aria-label="completion progress">
      <div id="bar"></div>
    </div>
  </div>
</header>

<main class="wrap">

  <!-- Header fields -->
  <section class="card">
    <div class="card-h">
      <h2>Run Details</h2>
      <div class="meta">Add details for reporting & consistency</div>
    </div>
    <div class="card-b">
      <div class="row">
        <div class="field">
          <label for="site">Site / Campus / Unit</label>
          <input id="site" type="text" placeholder="e.g., Maple Hall Dining" />
        </div>
        <div class="field">
          <label for="manager">Manager / Marketer</label>
          <input id="manager" type="text" placeholder="Name" />
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <div class="field">
          <label for="meal">Meal Period</label>
          <input id="meal" type="text" placeholder="Breakfast / Lunch / Dinner" />
        </div>
        <div class="field">
          <label for="time">Time (optional)</label>
          <input id="time" type="time" />
        </div>
      </div>

      <div class="field" style="margin-top:10px">
        <label for="overallNotes">Overall Notes (optional)</label>
        <textarea id="overallNotes" placeholder="Quick summary of the day: wins, gaps, follow-ups..."></textarea>
      </div>
    </div>
  </section>

  <!-- SECTIONS -->
  <div id="sections"></div>

  <!-- Photos + closeout -->
  <section class="card">
    <div class="card-h">
      <h2>Photos</h2>
      <div class="meta">Capture merchandising, signage, before/after</div>
    </div>
    <div class="card-b">
      <div class="row">
        <div class="field">
          <label>Add photos (camera)</label>
          <input id="photoInputCamera" type="file" accept="image/*" capture="environment" multiple />
          <div class="small">On mobile, this opens the camera. You can take multiple photos.</div>
        </div>
        <div class="field">
          <label>Add photos (library)</label>
          <input id="photoInputLibrary" type="file" accept="image/*" multiple />
          <div class="small">Use this to upload existing images from your phone.</div>
        </div>
      </div>

      <div class="photos" id="photoGrid" aria-label="photo thumbnails"></div>

      <div class="field" style="margin-top:12px">
        <label for="photoNotes">Photo Notes</label>
        <textarea id="photoNotes" placeholder="What do these photos show? What needs follow-up?"></textarea>
      </div>
    </div>
  </section>

  <section class="card">
    <div class="card-h">
      <h2>End-of-Day Closeout</h2>
      <div class="meta">Capture actions & accountability</div>
    </div>
    <div class="card-b">
      <div class="field">
        <label for="actionsNext">Actions / Owners / Next Steps</label>
        <textarea id="actionsNext" placeholder="Example: Replace outdated signage (Owner: Sam, Due: Fri)"></textarea>
      </div>
      <div class="field" style="margin-top:10px">
        <label for="shareNotes">What should be shared with Ops leadership?</label>
        <textarea id="shareNotes" placeholder="Key wins, recurring issues, student feedback trends..."></textarea>
      </div>
      <div class="small">
        Tip: Use <b>Export JSON</b> to send your run to a teammate or to paste into another system.
      </div>
    </div>
  </section>

</main>

<script>
  // --------- Checklist Data (editable) ----------
  const CHECKLIST = [
    {
      id: "pre_service",
      title: "Daily Brand & Experience Readiness (Pre-Service)",
      subtitle: "Entrance, first impression, dining room atmosphere",
      items: [
        { id:"welcome_signage", label:"Welcome signage installed, clean, aligned with current messaging", hint:"No outdated collateral; One & All inclusive tone." },
        { id:"greeter_ready", label:"Greeter positioned & trained on menu highlights/allergens/promos", hint:"First 10 seconds set the tone." },
        { id:"digitals_working", label:"Digital screens / content functioning and updated", hint:"No expired promos." },
        { id:"space_clear", label:"Entrance free of clutter and visual distractions", hint:"Keep it intentional and inviting." },
        { id:"lighting_audio", label:"Lighting & audio match brand tone and meal period", hint:"Comfortable, student-friendly." },
        { id:"dining_room_ready", label:"Dining room clean, high-touch areas checked, tables set", hint:"Work with campus partners if needed." }
      ]
    },
    {
      id: "platform_marketing",
      title: "Platform-Level Marketing & Merchandising",
      subtitle: "Food-forward execution and visual standards",
      items: [
        { id:"food_first", label:"Platforms are food-first (minimal non-essential items)", hint:"Allow food to be the focal point." },
        { id:"fresh_pan", label:"Fresh pans used; no refilling on the line", hint:"Replace with new pan from kitchen." },
        { id:"garnish", label:"Garnishes used intentionally and consistently", hint:"Small detail = big impact." },
        { id:"negative_space", label:"Negative space respected (no overcrowding)", hint:"Avoid clutter; keep it clean." },
        { id:"identifiers", label:"Item identifiers displayed; readable; allergens/nutrition accurate", hint:"Use Printables+/digital templates where available." },
        { id:"sneezeguards", label:"Sneezeguards cleaned before service; no writing/taping", hint:"Keep spotless and clear." }
      ]
    },
    {
      id: "desserts_peripherals",
      title: "Desserts & Peripherals",
      subtitle: "Finish strong; use desserts to elevate the experience",
      items: [
        { id:"dessert_height", label:"Desserts merchandised with height variation (risers/trays)", hint:"Create visual interest." },
        { id:"dessert_timing", label:"Dessert levels staged for peak times (not all out too early)", hint:"Match peak hour." },
        { id:"portioned", label:"Individual portions used where required (no bulk pudding/gelatin)", hint:"Garnish where appropriate." },
        { id:"dessert_fill", label:"Desserts used to fill gaps / unused wells appropriately", hint:"Merchandising with purpose." }
      ]
    },
    {
      id: "engagement",
      title: "Daily Engagement & Programming",
      subtitle: "Experiences Matter execution + campus connection",
      items: [
        { id:"six_feet_greet", label:"Guests greeted within 6 feet; eye contact made", hint:"Simple behavior, huge impact." },
        { id:"taste_tell", label:"Staff can explain ingredients, preparation, and allergens", hint:"Taste test + confident service." },
        { id:"daily_highlights", label:"Daily highlights communicated verbally and visually", hint:"Feature items, wellness, specials." },
        { id:"campus_alignment", label:"Coordination with campus calendar (tours/events/exams)", hint:"Dining is a destination." },
        { id:"capture_content", label:"Photo/video captured (when applicable) for storytelling", hint:"Use for future posts/recaps." }
      ]
    },
    {
      id: "signage",
      title: "Signage & Visual Compliance",
      subtitle: "Consistency and standards",
      items: [
        { id:"welcome_board", label:"Welcome boards updated daily", hint:"Fresh and relevant." },
        { id:"commitment", label:"Commitment statements visible in focal areas", hint:"Supports trust and brand." },
        { id:"station_signage", label:"Station signage consistent across platforms", hint:"No mixed formats." },
        { id:"no_handwritten", label:"No handwritten/taped/non-approved signage visible", hint:"Replace with approved templates." }
      ]
    },
    {
      id: "team_alignment",
      title: "Team Alignment & Brand Behavior",
      subtitle: "Uniforms, training reinforcement, One & All vibe",
      items: [
        { id:"uniforms", label:"Uniforms align with position-based standards", hint:"Professional and consistent." },
        { id:"appearance", label:"Staff appearance supports welcoming brand vibe", hint:"Approachable + polished." },
        { id:"huddle_values", label:"One & All values reinforced in daily huddles", hint:"Make inclusion visible." }
      ]
    },
    {
      id: "measurement",
      title: "Measurement & Continuous Improvement",
      subtitle: "Close loops and build momentum",
      items: [
        { id:"feedback", label:"Guest feedback reviewed and categorized (wins/gaps)", hint:"Capture patterns." },
        { id:"menu_compliance", label:"Menu compliance tracked (target 80%+)", hint:"Note reasons for variance." },
        { id:"action_log", label:"Brand gaps logged with priority and owner", hint:"Turn observations into actions." }
      ]
    },
    {
      id: "sustainability",
      title: "Sustainability & Responsibility",
      subtitle: "Visible, accurate, and consistent messaging",
      items: [
        { id:"sustain_msg", label:"Sustainability messaging visible and accurate", hint:"Match what’s operationally true." },
        { id:"togo", label:"To-go/disposables follow program expectations", hint:"No ad-hoc substitutions." },
        { id:"waste", label:"Waste reduction / recovery efforts communicated appropriately", hint:"Show progress without over-claiming." }
      ]
    }
  ];

  // --------- State ----------
  const state = {
    runDate: new Date().toISOString().slice(0,10),
    site: "",
    manager: "",
    meal: "",
    time: "",
    overallNotes: "",
    photoNotes: "",
    actionsNext: "",
    shareNotes: "",
    photos: [], // {name, dataUrl}
    checks: {}, // itemId -> true/false
    comments: {} // itemId -> string
  };

  // --------- Helpers ----------
  const $ = (id) => document.getElementById(id);

  function pctComplete(){
    const total = CHECKLIST.reduce((n,s)=>n+s.items.length,0);
    const done = Object.values(state.checks).filter(Boolean).length;
    return { total, done, pct: total ? Math.round((done/total)*100) : 0 };
  }

  function updateHeader(){
    $("runDate").textContent = state.runDate;
    $("siteName").textContent = state.site?.trim() ? state.site.trim() : "—";
    const {pct} = pctComplete();
    $("pct").textContent = pct + "%";
    $("bar").style.width = pct + "%";
  }

  function persist(){
    localStorage.setItem("rd_checklist_v1", JSON.stringify(state));
    toast("Saved locally ✓");
  }

  function load(){
    const raw = localStorage.getItem("rd_checklist_v1");
    if(!raw) return;
    try{
      const saved = JSON.parse(raw);
      Object.assign(state, saved);
    }catch(e){}
  }

  function resetAll(){
    localStorage.removeItem("rd_checklist_v1");
    location.reload();
  }

  function toast(msg){
    const t = document.createElement("div");
    t.textContent = msg;
    Object.assign(t.style,{
      position:"fixed",left:"50%",bottom:"18px",transform:"translateX(-50%)",
      background:"rgba(0,0,0,.85)",border:"1px solid rgba(0,0,0,.2)",
      padding:"10px 12px",borderRadius:"14px",color:"#fff",fontWeight:"800",
      zIndex:9999,boxShadow:"0 10px 25px rgba(0,0,0,.25)"
    });
    document.body.appendChild(t);
    setTimeout(()=>{t.style.opacity="0";t.style.transition="opacity .25s ease"}, 1300);
    setTimeout(()=>t.remove(), 1650);
  }

  function exportJSON(){
    const blob = new Blob([JSON.stringify(state, null, 2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `resident-dining-checklist_${state.site || "site"}_${state.runDate}.json`;
    a.click();
    URL.revokeObjectURL(url);
  }

  function showSummary(){
    const {total, done, pct} = pctComplete();
    const missing = [];
    for(const section of CHECKLIST){
      for(const item of section.items){
        if(!state.checks[item.id]) missing.push(item.label);
      }
    }
    const top = missing.slice(0,8).map((m,i)=>`${i+1}. ${m}`).join("\n");
    alert(
`Summary
Site: ${state.site || "—"}
Date: ${state.runDate}
Completion: ${done}/${total} (${pct}%)

Top gaps (first 8):
${top || "None — great work."}`
    );
  }

  // --------- Render ----------
  function render(){
    const container = $("sections");
    container.innerHTML = "";

    CHECKLIST.forEach(section=>{
      const card = document.createElement("section");
      card.className = "card";

      const head = document.createElement("div");
      head.className = "card-h";
      head.innerHTML = `
        <div>
          <h2>${section.title}</h2>
          <div class="small" style="margin-top:6px">${section.subtitle || ""}</div>
        </div>
        <div class="meta">Tap bubbles • add comments</div>
      `;
      card.appendChild(head);

      const body = document.createElement("div");
      body.className = "card-b";

      section.items.forEach(item=>{
        const row = document.createElement("div");
        row.className = "item";

        const left = document.createElement("div");
        left.className = "text";
        left.innerHTML = `
          <p class="label">${item.label}</p>
          ${item.hint ? `<p class="hint">${item.hint}</p>` : ""}
          <div class="subgrid">
            <div class="field">
              <label>Comment (optional)</label>
              <textarea data-comment="${item.id}" placeholder="Note issues, wins, owner, due date...">${state.comments[item.id] || ""}</textarea>
            </div>
          </div>
        `;

        const toggle = document.createElement("label");
        toggle.className = "toggle";
        toggle.setAttribute("role","switch");
        toggle.setAttribute("aria-label", item.label);

        const input = document.createElement("input");
        input.type = "checkbox";
        input.checked = !!state.checks[item.id];

        const knob = document.createElement("span");
        knob.className = "knob";

        toggle.appendChild(input);
        toggle.appendChild(knob);

        if(input.checked) toggle.classList.add("on");

        input.addEventListener("change", ()=>{
          stat




